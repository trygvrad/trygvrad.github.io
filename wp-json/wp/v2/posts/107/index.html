{"id":107,"date":"2024-02-12T12:28:19","date_gmt":"2024-02-12T12:28:19","guid":{"rendered":"http:\/\/bentus\/?p=107"},"modified":"2024-02-12T12:52:49","modified_gmt":"2024-02-12T12:52:49","slug":"designing-multivariate-colormaps","status":"publish","type":"post","link":"http:\/\/bentus\/designing-multivariate-colormaps\/","title":{"rendered":"Designing multivariate colormaps"},"content":{"rendered":"\n<p>Multivariate colormaps are seeing use in a number of domains that rely upon python ecosystem. I work with dark-field X-ray microscopy, which is one such domain, but there are numerous others, such as astronomy, polarization microscopy etc. While each domain may have dedicated tooling, <a href=\"https:\/\/gitlab.esrf.fr\/XRD\/darfix\">darfix<\/a>, <a href=\"https:\/\/www.astropy.org\/\">astropy<\/a>, <a href=\"https:\/\/xrayutilities.sourceforge.io\/\">xrayutilities<\/a> etc, this tooling is built upon the scientific python stack, including <a href=\"https:\/\/numpy.org\/\">numpy<\/a>, <a href=\"https:\/\/scipy.org\/\">scipy<\/a>, <a href=\"https:\/\/pandas.pydata.org\/\">pandas<\/a>, <a href=\"https:\/\/matplotlib.org\/\">matplotlib<\/a>, <a href=\"https:\/\/plotly.com\/\">plotly<\/a>, etc. Since these domains share common challenges regarding multivariate colormaps, it would be ideal to handle these challenges upstream (i.e. in matplotlib, plotly, etc.) rather than in the domain-specific packages. In addition to the technical implementation, the design criteria for multivariate colormaps must be explored. <\/p>\n\n\n\n<p>For the design of colormaps, <a href=\"https:\/\/arxiv.org\/search\/cs?searchtype=author&amp;query=Kovesi,+P\">Peter Kovesis<\/a> paper (2015) covers the topic with great diligence, as is <a href=\"https:\/\/www.youtube.com\/watch?v=xAoljeRJ3lU\">Nathaniel Smith and St\u00e9fan van der Walts talk<\/a> (2015) explaining the origin of the now-ubiquitous (at least in academia) &#8216;viridis&#8217; colormap. They outline an approach centered on human perception, where colormaps are designed to be perceptually uniform while maximizing the number of levels that can be distinguished. For multivariate colormaps, this approach has not previously been implemented.<\/p>\n\n\n\n<p><strong>2D colormaps<\/strong><br>Just as any continuous 1D colormap is a curve in colorspace, any continuous 2D colormap is a surface. <a href=\"https:\/\/arxiv.org\/search\/cs?searchtype=author&amp;query=Kovesi,+P\">Peter Kovesis<\/a>, <a href=\"https:\/\/www.youtube.com\/watch?v=xAoljeRJ3lU\">Nathaniel Smith and St\u00e9fan van der Walts <\/a>made the point that one should use a perceptually uniform colormap, such as <a href=\"https:\/\/en.wikipedia.org\/wiki\/CIELAB_color_space\">CIELAB<\/a> when designing 1D colormaps, and this remains true for 2D colormaps. The sRBG color gamut is illustrated below in the colorspace CAM02-LCD (Large Color Difference) <a href=\"https:\/\/doi.org\/10.1002\/col.20227\" data-type=\"link\" data-id=\"https:\/\/doi.org\/10.1002\/col.20227\">Luo et al. (2006)<\/a>.<\/p>\n\n\n\n<iframe loading=\"lazy\" src=\"https:\/\/trygvrad.github.io\/plotly_2D_colormaps\/fig.html\" height=\"520\" width=\"420\" frameborder=\"0\" allow=\"fullscreen\"><\/iframe>\n\n\n\n<p>CAM02-LCD (and CIELAB) describes colorspace using three orthogonal axes: <strong>L*<\/strong>: lightness, <strong>a*<\/strong>: green-red, and <strong>b*<\/strong>: blue-yellow. The colorspace is designed to be perceptually uniform, i.e. the distance you need to move along an axis before you notice a change, should be the same along <strong>L*<\/strong>, <strong>a*<\/strong>, and <strong>b*<\/strong>.<\/p>\n\n\n\n<p>Colormap design is further determined by the kind of data the colormap is designed to represent. <a href=\"https:\/\/matplotlib.org\/stable\/users\/explain\/colors\/colormaps.html#ibm\">Matplotlib<\/a> groups colormaps as <strong>sequential<\/strong>, <strong>diverging<\/strong>, and <strong>cyclic<\/strong> (in addition to qualitative), designed to represent data that fit into those categories. For 2D colormaps, the two axis can represent categorically different data, making 6 different categories: sequential\u00d7sequential, sequential\u00d7diverging, sequential\u00d7cyclic, diverging\u00d7diverging, diverging\u00d7cyclic, cyclic\u00d7cyclic. One can compare the different categories to the axis in CIELAB space, where <strong>L*<\/strong> is <strong>sequential<\/strong>, <strong>a*\/b*<\/strong> is <strong>diverging<\/strong>, and the <strong>hue<\/strong> (azimuthal around a*=b*=0) is <strong>cyclic<\/strong>.  <\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1018\" height=\"513\" src=\"http:\/\/bentus\/wp-content\/uploads\/2024\/02\/axes-1.png\" alt=\"\" class=\"wp-image-134\" style=\"width:839px;height:auto\" srcset=\"http:\/\/bentus\/wp-content\/uploads\/2024\/02\/axes-1.png 1018w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/axes-1-300x151.png 300w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/axes-1-768x387.png 768w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/axes-1-600x302.png 600w\" sizes=\"(max-width: 1018px) 100vw, 1018px\" \/><\/figure>\n\n\n\n<p>These most relevant categories, are shown as 2D planes in 3D Lab space above.<\/p>\n\n\n\n<p>Using the shapes above to slice the sRGB color gamut will produce 2D colormaps. <\/p>\n\n\n\n<img decoding=\"async\" src=\"http:\/\/bentus:8000\/cmaps.svg\" style=\"width:820px;\">\n<iframe loading=\"lazy\" src=\"https:\/\/trygvrad.github.io\/plotly_2D_colormaps\/3D_orangeBlue.html\" height=\"200\" width=\"185\" frameborder=\"0\" allow=\"fullscreen\"><\/iframe>\n<iframe loading=\"lazy\" src=\"https:\/\/trygvrad.github.io\/plotly_2D_colormaps\/3D_cut.html\" height=\"200\" width=\"185\" frameborder=\"0\" allow=\"fullscreen\"><\/iframe>\n<iframe loading=\"lazy\" src=\"https:\/\/trygvrad.github.io\/plotly_2D_colormaps\/3D_barrel.html\" height=\"200\" width=\"185\" frameborder=\"0\" allow=\"fullscreen\"><\/iframe>\n<iframe loading=\"lazy\" src=\"https:\/\/trygvrad.github.io\/plotly_2D_colormaps\/3D_peak.html\" height=\"200\" width=\"185\" frameborder=\"0\" allow=\"fullscreen\"><\/iframe>\n\n\n\n<p>Note that defining colormaps in Lab-space limits how much of the color gamut we can utilize. Colormaps defined in sRGB space provide a better utilization of the color gamut. Consider the following blue-orange bi-sequential colormaps:<\/p>\n\n\n\n<iframe loading=\"lazy\" src=\"https:\/\/trygvrad.github.io\/plotly_2D_colormaps\/orange_blue_Lab.html\" height=\"300\" width=\"285\" frameborder=\"0\" allow=\"fullscreen\" scrolling=\"no\" ><\/iframe>\n<img decoding=\"async\" src=\"http:\/\/bentus:8000\/defined_in_mod.svg\" style=\"height:300px;\">\n<iframe loading=\"lazy\" src=\"https:\/\/trygvrad.github.io\/plotly_2D_colormaps\/orange_blue_RGB.html\" height=\"300\" width=\"285\" frameborder=\"0\" allow=\"fullscreen\" scrolling=\"no\" ><\/iframe>\n\n\n\n<p>The colormap defined in sRGB space has increased saturation because it is not limited by perceptual uniformity (i.e. the maximum orange has higher <strong>L*<\/strong> than the maximum blue). For many applications, the loss of perceptual uniformity is an acceptable trade for increased saturation (making the colormap &#8216;pop&#8217; more).<\/p>\n\n\n\n<p class=\"has-large-font-size\">Adapting for colorblindness<\/p>\n\n\n\n<p>It is not possible to fully accommodate the various kinds of colorblindness in multi-dimensional colormaps. However, it is worth noting all the common forms of color-blindness affect primarily the <strong>a<\/strong>* (red-green) axis in Lab colorspace. Thus, when we design colormaps by slicing Lab space, we should preferentially slice along the <strong>b<\/strong>* (blue-yellow) axis, as is done above for the colormaps &#8216;orangeBlue&#8217; and &#8216;cut&#8217;. However, when making use of a the <strong>hue<\/strong> in a cyclic colormap, this is not possible. <\/p>\n\n\n\n<p>However, the hue can be cycled freely, and for the relevant colormaps the axes can be chosen such that the main features of the data are accessible also to those with common forms of colorblindness. The following figure shows the same data as seen by someone with normal color vision, and someone whom is red-green colorblind. For both cases, the data is shown with two different rotations of the colormap. With normal color vision, it is easily discernible that the two circled regions have different hue, but for someone who is red-green colorblind, this is only apparent if the colormap is rotated so that they are differentiated along the blue-yellow axis.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"442\" src=\"http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166-1024x442.png\" alt=\"\" class=\"wp-image-136\" srcset=\"http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166-1024x442.png 1024w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166-300x130.png 300w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166-768x332.png 768w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166-1536x663.png 1536w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166-1400x605.png 1400w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166-600x259.png 600w, http:\/\/bentus\/wp-content\/uploads\/2024\/02\/path166.png 1614w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<p>The rotation of the colormap is therefore of critical importance for accommodating those with common forms of colorblindness. <br><br><\/p>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Multivariate colormaps are seeing use in a number of domains that rely upon python ecosystem. I work with dark-field X-ray microscopy, which is one such domain, but there are numerous others, such as astronomy, polarization microscopy etc. While each domain may have dedicated tooling, darfix, astropy, xrayutilities etc, this tooling is built upon the scientific&#8230; <a class=\"more-link\" href=\"http:\/\/bentus\/designing-multivariate-colormaps\/#more-107\">Continue Reading &rarr;<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/bentus\/wp-json\/wp\/v2\/posts\/107"}],"collection":[{"href":"http:\/\/bentus\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/bentus\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/bentus\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/bentus\/wp-json\/wp\/v2\/comments?post=107"}],"version-history":[{"count":22,"href":"http:\/\/bentus\/wp-json\/wp\/v2\/posts\/107\/revisions"}],"predecessor-version":[{"id":146,"href":"http:\/\/bentus\/wp-json\/wp\/v2\/posts\/107\/revisions\/146"}],"wp:attachment":[{"href":"http:\/\/bentus\/wp-json\/wp\/v2\/media?parent=107"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/bentus\/wp-json\/wp\/v2\/categories?post=107"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/bentus\/wp-json\/wp\/v2\/tags?post=107"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}